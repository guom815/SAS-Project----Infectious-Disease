proc import out=final_project
	datafile="/home/u63582559/EP755/EP755_final.xlsx"
	DBMS=XLSX replace;
	getnames=yes;
run;
/*Part 1_1*/
data final_project_1;
	set final_project;
	if age=. then agelt40=.;
	else if age<40 then agelt40=1;
	else if age>=40 then agelt40=0;
	if bmi=. then obese=.;
	else if bmi>=30 then obese=1;
	else if bmi<30 then obese=0;
/*Part 1_2*/
proc sort;
	by HIV;
run;
proc freq order=data;
	tables HIV;
run;
proc freq;
	tables HIV site employ smk prevdm prevhtn mh resp cvd bio_sex agelt40 obese;
run;
proc freq;
	tables HIV site employ smk prevdm prevhtn mh resp cvd bio_sex agelt40 obese;
	by HIV;
run;
proc univariate data=final_project_1;
	var age bmi;
run; 
proc freq;
	tables HIV site employ smk prevdm prevhtn mh resp cvd bio_sex agelt40 obese;
	by HIV;
run;
proc univariate data=final_project_1;
	var age bmi;
run; 
proc means data=final_project_1 n nmiss;
	var age bmi;
run; 
proc univariate data=final_project_1;
	var age bmi;
	by HIV;
run; 
/*Part 1_3*/
data final_project_2;
	set final_project_1;
	if (fasted=. or glucose_val=.) then elevated_gl=.;
	else if (fasted=1 and glucose_val>=7) or (fasted=0 and glucose_val>=11.1) then elevated_gl=1;
	else if (fasted=1 and glucose_val<7) or (fasted=0 and glucose_val<11.1) then elevated_gl=0;
	if (syt_bp=. or dyst_bp=.) then elevated_bp=.;
	else if (syt_bp>=140 and dyst_bp>=90) then elevated_bp=1;
	else if (syt_bp<140 or dyst_bp<90) then elevated_bp=0;
	if (elevated_gl=. or prevdm=.) then elevated_glnpd=.;
	else if (elevated_gl=1 and prevdm=0) then elevated_glnpd=1; 
	else if (elevated_gl=0 and prevdm=0) then elevated_glnpd=0;
	if (elevated_bp=. or prevhtn=.) then elevated_bpnph=.;
	else if (elevated_bp=1 and prevhtn=0) then elevated_bpnph=1;
	else if (elevated_bp=0 and prevhtn=0) then elevated_bpnph=0;
run;
proc sort;
	by HIV;
run;
proc freq order=data;
	tables elevated_gl elevated_bp elevated_glnpd elevated_bpnph linked;
run;
proc freq order=data;
	tables elevated_gl elevated_bp elevated_glnpd elevated_bpnph linked;
	by HIV;
run;
/*Part 2*/
proc sort data=final_project_2;;
	by bio_sex;
run;
proc freq data=final_project_2;
	tables HIV*elevated_bpnph;
	by bio_sex;
run;
proc sort data=final_project_2;;
	by agelt40;
run;
proc freq data=final_project_2;
	tables HIV*elevated_bpnph;
	by agelt40;
run;
proc sort data=final_project_2;;
	by obese;
run;
proc freq data=final_project_2;
	tables HIV*elevated_bpnph;
	by obese;
run;
proc sort data=final_project_2;;
	by prevdm;
run;
proc freq data=final_project_2;
	tables HIV*elevated_bpnph;
	by prevdm;
run;
proc sort data=final_project_2;;
	by smk;
run;
proc freq data=final_project_2;
	tables HIV*elevated_bpnph;
	by smk;
run;
proc sort data=final_project_2;;
	by employ;
run;
proc freq data=final_project_2;
	tables HIV*elevated_bpnph;
	by employ;
run;
/*Part 3*/
proc genmod data=final_project_2 desc;
	model elevated_bp = HIV / link=log dist=bin;
	estimate "Risk Ratio" HIV 1 / exp;
run;
proc genmod data=final_project_2 desc;
	model elevated_bp = HIV bio_sex agelt40 obese prevdm / link=log dist=bin;
	estimate "Risk Ratio for PLWH vs PLWOH" HIV 1 / exp;
	estimate "Risk Ratio for male vs female" bio_sex 1 / exp;
	estimate "Risk Ratio for agelet40 vs agelaeqt40" agelt40 1 / exp;
	estimate "Risk Ratio for obese vs non_obese" obese 1 / exp;
	estimate "Risk Ratio for prediabetes vs no_prediabetes" prevdm 1 / exp;
run;
